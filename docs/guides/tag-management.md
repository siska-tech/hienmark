# タグ管理機能ガイド

## 概要

HienMarkのタグ管理機能は、ワークスペース内の全タスクからタグを自動的に集約し、タグスキーマの定義、統計情報の表示、値の一括リネーム・削除などを行う強力な機能です。

## タグとは

HienMarkでは、タスクファイル（Markdown）の先頭にあるYAML Front Matter内のキー・バリューペアを「タグ」として扱います。

```yaml
---
status: pending
priority: high
tags: [bug, needs-investigation]
assigned_to: user1
due_date: 2025-12-31
---

# タスクの本文
```

この例では、以下のタグが定義されています：
- `status`: 値は `pending`
- `priority`: 値は `high`
- `tags`: 値は配列 `[bug, needs-investigation]`
- `assigned_to`: 値は `user1`
- `due_date`: 値は `2025-12-31`

## タグ管理画面を開く

1. ワークスペースを開いた状態で、ヘッダーの「**タグ管理**」ボタン（ピンアイコン）をクリック
2. タグ管理画面（Tag Settings View）が表示されます
3. 再度同じボタンをクリックすると、通常のタスク表示に戻ります

## タグ管理画面の構成

タグ管理画面は、左側のマスターペインと右側のディテールペインで構成されています。

### 左ペイン：マスター（タグリスト）

- ワークスペース内の全タグが一覧表示されます
- 各タグアイテムには以下の情報が表示されます:
  - **タグ名**: タグのキー（例: `status`, `priority`）
  - **タグ型**: 定義されている属性タイプ（String, Number, Boolean, Datetime, Select, MultiSelect, Currency, Image, Hyperlink）または "Undefined"（未定義）
  - **使用数**: そのタグが使われているタスク数
  - **削除ボタン**: タグスキーマから削除（定義済みタグのみ）
- タグをクリックすると、右ペインに詳細が表示されます

### 右ペイン：ディテール（選択タグの詳細）

選択したタグの詳細設定や統計情報が表示されます。

## タグスキーマの定義

### 新しいタグの追加

1. 左ペインの「**＋ タグを追加**」ボタンをクリック
2. 右ペインに新規タグ作成フォームが表示されます
3. 以下を入力:
   - **タグキー**: タグの識別子（例: `status`, `priority`）
   - **タグ型**: String, Number, Boolean, Datetime, Select, MultiSelect, Currency, Image, Hyperlink から選択
4. 保存ボタン（✓）をクリック

### タグの属性設定

定義済みタグを選択すると、その属性タイプに応じた設定フォームが表示されます。

#### String（文字列）
- **最大文字数**: 制限を設ける場合は数値を入力
- **デフォルト値**: 新規タスク作成時のデフォルト値

#### Number（数値）
- **最小値**: 入力可能な最小値
- **最大値**: 入力可能な最大値
- **小数桁数**: 表示する小数桁数（例: 2）
- **パーセント表示**: チェックすると100倍して表示
- **デフォルト値**: 新規タスク作成時のデフォルト値

#### Boolean（真偽値）
- **デフォルト値**: 新規タスク作成時のデフォルト値（true/false/未指定）

#### Datetime（日付・時刻）
- **フォーマット**: 日付のみ / 日付+時刻
- **デフォルト値**: 静的な日付（例: `2025-01-01`）または動的計算式（例: `=[TODAY]+7`）

#### Select（単一選択）
- **選択肢のリスト**: カンマ区切りで入力（例: `high, medium, low`）
- **手動入力を許可**: リスト以外の値も入力可能にする
- **表示形式**: ドロップダウン / ラジオボタン
- **デフォルト値**: 選択肢から1つ

#### MultiSelect（複数選択）
- **選択肢のリスト**: カンマ区切りで入力（例: `bug, feature, enhancement`）
- **手動入力を許可**: リスト以外の値も入力可能にする

#### Currency（通貨）
- **最小値**: 入力可能な最小値
- **最大値**: 入力可能な最大値
- **小数桁数**: 通貨の小数桁数（デフォルト: 2）
- **通貨形式**: JPY / USD / EUR
- **デフォルト値**: 新規タスク作成時のデフォルト値

#### Image（画像）
- 設定項目なし

#### Hyperlink（ハイパーリンク）
- 設定項目なし

### タグスキーマの保存

1. 右下の保存ボタン（✓）をクリック
2. 「変更を保存しました」と表示されたら完了です

## タグの統計情報

### 統計タブ

選択したタグの統計情報を表示します。

- **ユニーク値数**: そのタグにいくつの異なる値があるか
- **総使用回数**: そのタグが使われているタスクの総数

### 値別の使用状況

値ごとの使用回数がチップ形式で表示されます。チップをクリックすると、その値を使用しているタスク一覧が表示されます。
- タスクIDをクリックすると、そのタスクを開けます

## タグのリネーム・削除

⚠️ **注意**: タグスキーマの定義と実際のタスクファイル内のタグ値の操作は異なります。

### スキーマからタグ定義を削除

定義済みタグの削除ボタン（×）をクリックすると、タグスキーマからその定義が削除されます。**実際のタスクファイル内のタグは削除されません。**

### 未定義タグの定義化

スキャンされているがスキーマに定義されていないタグ（"Undefined"）を選択すると、推奨される型が自動的に推定されて表示されます。

- 推奨型から選択して、「＋」ボタンでスキーマに追加できます

## 検索・フィルタ・ソート機能

### 検索

左ペイン上部の検索ボックスでタグ名を検索できます。

### フィルタ

フィルタボタンをクリックすると、以下のフィルタ条件を設定できます：

- **並び順**: 使用数 / 名前 / 属性 / 値名
- **昇順/降順**: トグルスイッチで切り替え
- **属性でフィルタ**: 特定のタグ型のみ表示（例: Select のみ）
- **最小使用数**: 指定した数以上使用されているタグのみ表示
- **未使用を非表示**: チェックすると使用数0のタグを隠します
- **テンプレートで使用**: 特定のテンプレートで使用されているタグのみ表示

## 実用的な使用例

### 例1: ステータス管理の統一

**シナリオ**: プロジェクト全体でステータス値を統一したい

1. タグ管理画面で `status` タグを選択（または新規作成）
2. タグ型を `Select` に設定
3. 「選択肢のリスト」に `todo, in_progress, review, done` を入力
4. 保存後、タグ編集時にこれらの値のみが選択肢として表示されます

### 例2: 優先度の数値スケール

**シナリオ**: 優先度を1〜5の数値で管理したい

1. タグ管理画面で `priority` タグを選択（または新規作成）
2. タグ型を `Number` に設定
3. 最小値を `1`、最大値を `5` に設定
4. 保存後、タグ編集時に1〜5の範囲のみ入力可能になります

### 例3: 自動期限設定

**シナリオ**: 新規タスクの期限を自動的に7日後に設定したい

1. タグ管理画面で `due_date` タグを選択（または新規作成）
2. タグ型を `Datetime` に設定
3. 「フォーマット」を「日付のみ」に設定
4. 「デフォルト値」に `=[TODAY]+7` を入力
5. 保存後、新規タスク作成時に自動的に7日後の日付が設定されます

### 例4: 複数選択タグ

**シナリオ**: タスクに複数のラベルを付ける

1. タグ管理画面で `labels` タグを選択（または新規作成）
2. タグ型を `MultiSelect` に設定
3. 「選択肢のリスト」に `bug, feature, enhancement, documentation` を入力
4. 保存後、タグ編集時に複数のチェックボックスが表示されます

### 例5: タグの使用状況を確認

**シナリオ**: どのタグがよく使われているか確認したい

1. タグ管理画面で左ペインのタグリストを確認
2. 各タグの使用数を確認
3. フィルタ機能で「最小使用数」を設定して絞り込み
4. 特定のタグを選択して、統計タブで値別の使用状況を確認

## データの保存場所

### タグスキーマ

タグスキーマはワークスペースの `.hienmark/tag-schema.json` に保存されます。

```json
{
  "status": {
    "type": "Select",
    "options": {
      "optionsList": ["todo", "in_progress", "review", "done"],
      "allowManualEntry": false,
      "defaultValue": "todo",
      "displayFormat": "dropdown"
    }
  },
  "priority": {
    "type": "Number",
    "options": {
      "min": 1,
      "max": 5,
      "decimalPlaces": 0,
      "defaultValue": 3
    }
  }
}
```

### タグインデックス

タグの使用状況はメモリ上で管理され、Tauriバックエンドが自動的に構築します。

## トラブルシューティング

### タグが表示されない

- ワークスペースが正しく開かれているか確認
- タスクファイルのFront Matterが正しいYAML形式か確認
- ワークスペースを再読み込みしてみる

### タグスキーマが保存されない

- ワークスペースディレクトリの書き込み権限があるか確認
- `.hienmark` ディレクトリと `tag-schema.json` ファイルが正しく作成されているか確認
- 保存ボタン（✓）をクリックしたか確認

### 統計情報が更新されない

- タグスキーマを変更しても実際のタスクファイルは変更されません
- タスクを追加・編集すると、タグインデックスが自動的に更新されます
- ワークスペースを再読み込みすると統計情報が再計算されます

### タグ型の変更が反映されない

- タグスキーマを変更した後、保存ボタン（✓）をクリックする必要があります
- 既存のタスクファイルは変更されません
- 新規作成したタスクやテンプレート適用時に新しい設定が反映されます

## 関連機能

- [テンプレート機能ガイド](tag-templates.md) - タグテンプレートの使い方
- [分析ダッシュボードガイド](analysis-dashboard.md) - タグデータの可視化
- [テンプレートクイックスタート](template-quick-start.md) - テンプレート機能の基本
- [ワークスペース管理ガイド](workspace-management.md) - ワークスペースの設定と管理

