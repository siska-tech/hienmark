# ワークスペース管理ガイド

## 概要

HienMarkでは、プロジェクトごとに「ワークスペース」を作成し、その中でタスクを管理します。ワークスペースは単純にディレクトリ（フォルダ）として管理され、ローカルファイルシステム上に保存されます。

## ワークスペースとは

ワークスペースは、タスクファイル（Markdown）を格納するディレクトリです。以下のような構造になっています：

```
my-project/
├── task-001.md
├── task-002.md
├── task-003.md
├── subdirectory/
│   └── task-004.md
└── .hienmark/
    ├── .hienmark.json
    ├── tag_schema.json
    └── analysis_settings.json
```

**ワークスペースの特徴:**
- 任意のディレクトリをワークスペースとして開くことができます
- 再帰的に `.md` ファイルをスキャンします（サブディレクトリも含む）
- ワークスペース設定は `.hienmark/` ディレクトリに保存されます
- 完全にローカルで動作し、クラウド不要です

## ワークスペースを開く

### 初回起動時

1. HienMarkを起動
2. ヘッダーの「**ワークスペースを開く**」ボタンをクリック
3. ファイル選択ダイアログが開きます
4. ワークスペースとして使用したいディレクトリを選択
5. 「選択」をクリック

### 2回目以降

前回開いたワークスペースが自動的に読み込まれます。

**自動読み込みの仕組み:**
- 最後に開いたワークスペースのパスがアプリケーション設定に保存されます
- 次回起動時に自動的にそのワークスペースを読み込みます
- 手動で別のワークスペースを開くことも可能です

### 手動でワークスペースを変更

1. ヘッダーの「**ワークスペースを開く**」ボタンをクリック
2. 新しいディレクトリを選択
3. ワークスペースが切り替わります

## ワークスペース設定

ワークスペース設定は `.hienmark.json` ファイルに保存されます。

### 設定ファイルの場所

```
ワークスペースルート/
└── .hienmark/
    └── .hienmark.json
```

### 設定項目

**タグモード設定:**
- `strictTagMode`: 固定モード（true）または任意モード（false）
- `allowedCategories`: 許可されたタグカテゴリのリスト（固定モード時のみ）

**ファイル監視:**
- `watchEnabled`: ファイル変更の自動監視を有効化/無効化

**テンプレート設定:**
- `templates`: タグテンプレートのコレクション
- `defaultTemplate`: デフォルトテンプレート名

**タグ設定:**
- `tag_configs`: タグの設定（エイリアス、許容値など）

**自動保存設定:**
- `autoSaveEnabled`: 自動保存の有効化/無効化
- `autoSaveInterval`: 自動保存までの時間（ミリ秒）

**テーマ設定:**
- `theme`: カラーテーマ名（例: `HienMark Dark`, `HienMark Light`）

### 設定の編集

設定は以下の画面から編集できます：

- **タグ設定画面**: タグモード、許可カテゴリの設定
- **テンプレート管理画面**: テンプレートの管理
- **設定画面**: 自動保存、テーマなどの設定

設定の変更は自動的に `.hienmark.json` に保存されます。

## タスクファイルの管理

### タスクファイルの作成

1. タスク一覧の「**+ New Task**」ボタンをクリック
2. タスクID（ファイル名）を入力
3. 必要に応じてテンプレートを選択
4. タスクが作成され、エディタで開きます

**ファイル名の規則:**
- 拡張子は `.md`（自動的に付与されます）
- ファイル名はそのままタスクIDとして使用されます
- サブディレクトリに配置することも可能です

### タスクファイルの保存

**自動保存:**
- エディタで編集すると、3秒後に自動的に保存されます（デフォルト設定）
- 自動保存の設定は変更可能です

**手動保存:**
- `Ctrl+S`（Windows/Linux）または `Cmd+S`（macOS）で手動保存
- または、エディタの「保存」ボタンをクリック

### タスクファイルの削除

1. タスク一覧で削除したいタスクを右クリック
2. 「削除」を選択
3. 確認ダイアログで「OK」をクリック
4. ファイルが削除されます

⚠️ **注意**: この操作は元に戻せません。削除前にバックアップを取ることをお勧めします。

## ファイル監視機能

ワークスペース設定で「ファイル監視」を有効にすると、外部エディタでファイルを編集した場合でも、HienMarkの画面が自動的に更新されます。

### 監視機能の有効化

1. 設定画面を開く
2. 「ファイル監視」をオンに設定
3. 設定が保存されます

### 動作

- 外部エディタ（VS Code、Vimなど）でタスクファイルを編集
- ファイルが保存されると、HienMarkの画面が自動的に更新されます
- タスク一覧やエディタの内容が最新の状態に保たれます

**用途:**
- 外部エディタで編集しながら、HienMarkで分析・管理
- 複数のエディタで同時に作業
- Gitでの変更をリアルタイムに反映

## ワークスペースの構造

### 推奨ディレクトリ構造

```
project/
├── docs/
│   ├── planning/
│   │   └── task-planning-001.md
│   └── design/
│       └── task-design-001.md
├── tasks/
│   ├── task-001.md
│   ├── task-002.md
│   └── task-003.md
├── archive/
│   └── task-old-001.md
└── .hienmark/
    ├── .hienmark.json
    ├── tag_schema.json
    └── analysis_settings.json
```

### ディレクトリ構造の自由度

HienMarkは再帰的に `.md` ファイルをスキャンするため、ディレクトリ構造は自由に設計できます。

**柔軟な構造:**
- 日付別: `2025/01/task-001.md`
- プロジェクト別: `project-a/task-001.md`, `project-b/task-002.md`
- ステータス別: `todo/task-001.md`, `done/task-002.md`
- フラット: `task-001.md`, `task-002.md`

**制約:**
- ファイル名が重複しないように注意（同じタスクIDが複数あると問題が発生する可能性があります）

## ワークスペースのバックアップ

ワークスペースは通常のディレクトリなので、標準的なバックアップ方法が使用できます。

### 推奨バックアップ方法

**手動バックアップ:**
1. ワークスペースディレクトリ全体をコピー
2. 別の場所（USBメモリ、クラウドストレージなど）に保存

**自動バックアップ（推奨）:**
- Gitを使用してバージョン管理
- クラウドストレージ（Dropbox、OneDriveなど）と同期
- 定期的なバックアップスクリプトの実行

### バックアップに含めるべきもの

- 全ての `.md` ファイル（タスクファイル）
- `.hienmark/` ディレクトリ（設定ファイル）
  - `.hienmark.json`
  - `tag_schema.json`
  - `analysis_settings.json`
  - その他の設定ファイル

## ワークスペース間の切り替え

複数のプロジェクトを管理する場合、ワークスペースを切り替えることができます。

### 切り替え方法

1. 現在のワークスペースを閉じる必要はありません
2. 「**ワークスペースを開く**」ボタンをクリック
3. 新しいワークスペースディレクトリを選択
4. ワークスペースが切り替わります

### 注意点

- 前回のワークスペースの状態は保持されます
- エディタで編集中のタスクがある場合は、保存するかキャンセルする必要があります

## トラブルシューティング

### ワークスペースが開けない

- ディレクトリのパスが正しいか確認
- ディレクトリへの読み込み権限があるか確認
- ディレクトリが存在するか確認

### タスクが表示されない

- `.md` ファイルがワークスペース内に存在するか確認
- ファイルの拡張子が `.md` であることを確認
- ワークスペースを再読み込みしてみる（「ワークスペースを開く」で同じディレクトリを再選択）

### 設定が保存されない

- `.hienmark/` ディレクトリへの書き込み権限があるか確認
- ディスク容量が十分か確認
- アプリを再起動してみる

### ファイル監視が動作しない

- 設定で「ファイル監視」が有効になっているか確認
- ファイルシステムの監視がサポートされているか確認（ネットワークドライブなどでは動作しない場合があります）

## 次のステップ

- [タグ管理機能ガイド](tag-management.md) - タグの管理と設定
- [テンプレート機能ガイド](tag-templates.md) - タグテンプレートの使い方
- [分析ダッシュボードガイド](analysis-dashboard.md) - タスクデータの可視化
- [テンプレートクイックスタート](template-quick-start.md) - テンプレート機能の基本

