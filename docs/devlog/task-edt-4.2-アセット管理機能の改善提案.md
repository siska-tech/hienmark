---
status: pending
priority: medium
assignee: FE/BE
start_date: 
end_date: 
tags: ["編集機能", "REQ-EDT-004", "改善提案", "セキュリティ", "UX", "エラーハンドリング"]
depends_on: ["task-edt-4.1"]
---

# Task-EDT-4.2: アセット管理機能の改善提案

## 概要

Task-EDT-4.1で実装されたアセット管理機能について、堅牢性とセキュリティ、UXの観点から追加の改善を提案する確認事項タスク。

## 確認事項と改善提案

### 1. assetProtocolのスコープ（セキュリティ）

**現状:**
- `assetProtocol.scope: ["**"]`で設定されており、PC上のすべてのファイルへのアクセスを許可している

**課題:**
- セキュリティリスク: アプリが任意のローカルファイルにアクセス可能な状態
- ただし、CSPで`img-src`が制限されているため、即座に重大な脆弱性とはならない

**改善提案:**
- [ ] 可能であれば、セキュリティを向上させるため、スコープを現在のワークスペースディレクトリに限定する
- [ ] Tauriの`tauri-plugin-fs`などで動的にスコープを設定する方法を調査
- [ ] または、ユーザーにワークスペースフォルダの許可を求めるUIを実装

**検討事項:**
- Tauri v2で動的にスコープを設定できるかどうか
- ワークスペースパスが変更された場合の対応方法
- セキュリティと利便性のバランス

**優先度:** 中（セキュリティ向上のため、可能であれば実装推奨）

---

### 2. 複数ファイルの同時ドロップ（UX）

**現状:**
- `handleFileDrop(paths[0])`で最初のファイルのみ処理
- ユーザーが複数ファイル（例: 5枚の画像）を同時にドロップした場合、1ファイルのみ処理される

**課題:**
- ユーザーは「すべてのファイルがコピーされた」と誤解する可能性がある
- 複数ファイルの一括処理は一般的なUXパターン

**改善提案:**

**A案: 複数処理に対応**
- [ ] `handleFileDrop`を`paths`配列でループ処理するように変更
- [ ] 複数ファイルを順次処理し、すべてのファイルに対してMarkdown記法を挿入
- [ ] 処理中のフィードバック（プログレス表示など）を検討

**B案: UIでフィードバック**
- [ ] 複数ファイルが検知された場合（`paths.length > 1`）、ユーザーに通知を表示
- [ ] トースト通知またはモーダルで「一度に1つのファイルのみドロップ可能です」と表示
- [ ] または、複数ファイル処理に対応する旨をドキュメントに明記

**推奨:**
- **A案を推奨**（複数ファイルの一括処理は一般的なUXパターンのため）

**優先度:** 中（UX向上のため、実装推奨）

---

### 3. Rust側のエラーハンドリング（堅牢性）

**現状:**
- React側で`invoke('copy_asset_to_workspace', ...)`を`try...catch`で処理している
- Rust側で発生しうるエラーの種類と伝播方法を確認する必要がある

**想定されるエラーケース:**
- ディスクフル（`NoSpaceLeftOnDevice`）
- 書き込み権限エラー（`PermissionDenied`）
- ファイルロックエラー（`ResourceBusy`）
- ソースファイルが存在しない（`NotFound`）
- ネットワークドライブの接続エラー

**確認事項:**
- [ ] Rust側のエラー型が適切に定義されているか
- [ ] `Result<String, String>`として返されるエラーメッセージがユーザーに分かりやすいか
- [ ] React側の`catch`ブロックでエラーメッセージが適切に表示されているか
- [ ] 各種エラーケースに対する適切なエラーメッセージが返されているか

**改善提案:**
- [ ] Rust側でエラー型を詳細化（例: `Result<String, AssetError>`）
- [ ] エラーメッセージをユーザーフレンドリーな日本語に統一
- [ ] React側でエラー種類に応じた適切なUIフィードバック（トースト、アラートなど）
- [ ] エラーログの記録（デバッグ用）

**優先度:** 中（堅牢性向上のため、実装推奨）

---

## 実装優先度の推奨順

1. **優先度: 高**
   - （現在該当なし）

2. **優先度: 中**
   - **2. 複数ファイルの同時ドロップ（UX）** - A案（複数処理対応）を推奨
   - **3. Rust側のエラーハンドリング（堅牢性）** - ユーザー体験向上のため
   - **1. assetProtocolのスコープ（セキュリティ）** - 可能であれば実装

3. **優先度: 低**
   - **2. 複数ファイルの同時ドロップ（UX）** - B案（UIフィードバックのみ）の場合

## 実装時の注意事項

### セキュリティ
- `assetProtocol.scope`の変更は、アプリの動作に影響を与える可能性がある
- 変更前には十分なテストが必要

### UX
- 複数ファイル処理時は、処理時間が長くなる可能性がある
- ユーザーに処理中のフィードバックを提供することが重要

### エラーハンドリング
- エラーメッセージは技術的な詳細ではなく、ユーザーが理解できる内容にする
- ログには詳細な技術情報を含める

## 関連タスク

- Task-EDT-4.1: D&Dによるファイルコピーと相対パス挿入ロジック（前提タスク）

## メモ

- これらの改善提案は、現在の実装が機能していることを前提としている
- 各項目は独立して実装可能
- 優先度は要件やリリーススケジュールに応じて変更可能

