---
status: pending
priority: high
assignee: FE
start_date: null
end_date: null
tags: ["UI/UX", "REQ-UIX-001", "実装", "React"]
depends_on: ["task-uix-1.1-ツリービューui実装"]
---

# Task-UIX-1.2: フォルダ操作機能（コンテキストメニュー・D&D・CRUD）

## 概要

フォルダツリーに対して、フォルダ作成・削除・リネーム、タスクのドラッグ&ドロップ移動を実装する。

## タスク詳細

### 実装要件

- **コンテキストメニュー:** フォルダ/タスクの右クリックで操作メニューを表示
- **フォルダ作成:** 指定フォルダ下に新しいフォルダを作成
- **フォルダ削除:** 空フォルダのみ削除可能、中身がある場合は確認
- **フォルダリネーム:** フォルダ名を変更
- **タスク移動:** D&Dでタスクをフォルダ間で移動
- **バックエンド連携:** 既存の`create_folder`, `move_task`コマンドを使用

### チェックリスト

- [ ] コンテキストメニューコンポーネント実装
- [ ] フォルダ作成ダイアログ実装
- [ ] フォルダ削除確認ダイアログ実装
- [ ] フォルダリネーム入力実装
- [ ] ドラッグ&ドロップ実装（react-beautiful-dnd等）
- [ ] バックエンドコマンド連携
- [ ] UIスタイリング
- [ ] エラーハンドリング
- [ ] アクセシビリティ対応

## 技術詳細

### 使用ライブラリ候補

- **ドラッグ&ドロップ:** `@dnd-kit/core`, `react-dnd`, `react-beautiful-dnd`
- **コンテキストメニュー:** カスタム実装 or `react-contexify`
- **ダイアログ:** Tauri `ask` API またはカスタムモーダル

### バックエンドコマンド（既存）

- ✅ `create_folder`: ディレクトリ作成
- ✅ `move_task`: タスク移動
- ⏳ `rename_folder`: フォルダリネーム（未実装）
- ⏳ `delete_folder`: フォルダ削除（未実装）

### データフロー

1. **フォルダ作成:**
   - ユーザーがフォルダを右クリック → 「新規フォルダ」選択
   - フォルダ名入力ダイアログ表示
   - `createFolder(workspacePath, folderPath)` 呼び出し
   - 成功時、ワークスペース再読み込み

2. **フォルダ削除:**
   - ユーザーがフォルダを右クリック → 「削除」選択
   - 確認ダイアログ表示
   - `deleteFolder(workspacePath, folderPath)` 呼び出し
   - 成功時、ワークスペース再読み込み

3. **フォルダリネーム:**
   - ユーザーがフォルダを右クリック → 「名前変更」選択
   - リネーム入力表示
   - `renameFolder(workspacePath, oldPath, newPath)` 呼び出し
   - 成功時、ワークスペース再読み込み

4. **タスク移動:**
   - ユーザーがタスクをドラッグ
   - フォルダ上にドロップ
   - 現在のパスと移動先パスを特定
   - `moveTask(workspacePath, taskId, sourcePath, destPath)` 呼び出し
   - 成功時、ワークスペース再読み込み

### UI設計

#### コンテキストメニュー

```
┌─────────────────────┐
│ 新規フォルダ        │
│ 名前変更            │
│ 削除                │
├─────────────────────┤
│ タスクの場合のみ:   │
│ 移動...             │
└─────────────────────┘
```

#### ドラッグ&ドロップ

- ドラッグ開始: タスクアイコンにドラッグ中スタイル適用
- ドロップ可能ゾーン: フォルダアイコンの上
- ドロップ可能表示: ホバー状態でハイライト
- ドロップ禁止: 同じフォルダへの移動

### エラーハンドリング

- フォルダ名重複エラー
- 空でないフォルダの削除エラー
- 無効なパス文字列エラー
- ネットワークドライブアクセスエラー

## 成果物

- コンテキストメニューコンポーネント
- D&D実装
- バックエンドコマンド（`rename_folder`, `delete_folder`）
- フロントエンドサービス統合

## 依存タスク

- ✅ Task-UIX-1.1: ツリービューUI実装完了
- ✅ バックエンド: `create_folder`, `move_task` 実装完了
- ⏳ バックエンド: `rename_folder`, `delete_folder` 実装必要

## メモ

- 既存の`create_folder`, `move_task`は実装済み
- `rename_folder`, `delete_folder`のバックエンド実装が必要
- D&Dライブラリ選定はパフォーマンス要件を考慮
- ワークスペース再読み込みは必須（ファイル変更の反映）

