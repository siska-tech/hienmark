# 機能要件

## 4. 機能要件

### 4.1. コア機能：タスク編集 ✅ 実装完了

- **R-4.1.1 (Markdownレンダリング):** ✅ 実装済み
  - CommonMark仕様に準拠したMarkdownのリアルタイムプレビュー機能を提供すること。
  - 実装: markdown-it + DOMPurifyによる安全なHTML生成

- **R-4.1.2 (Mermaidレンダリング):** ✅ 実装済み
  - Markdown本文中に `` ```mermaid `` で記述されたMermaid記法を検出し、ダイアグラムとしてレンダリングできること。
  - 実装: mermaid.js 11.4 + セキュリティレベル設定

- **R-4.1.3 (シンタックスハイライト):** ✅ 実装済み
  - エディタ（CodeMirror 6）は、Markdown構文およびMermaidコードブロック内の構文をハイライトすること。
  - 実装: CodeMirror 6の言語パッケージを使用

---

### 4.2. タスク管理システム ✅ 95% 実装完了

- **R-4.2.1 (タスクの定義):** ✅ 実装済み
  - ワークスペース内の単一のMarkdownファイル（`.md`）を「1タスク」として扱うこと。

- **R-4.2.2 (タスクID):** ✅ 実装済み
  - 各タスクは一意のIDを持つこと。
  - プライマリIDはファイル名（OSの制約上、重複不可）とする。
  - タグ情報とファイル名を組み合わせた複合キーによる参照も可能とすること。

- **R-4.2.3 (タスクブラウザ):** ✅ 実装済み
  - ワークスペース内のタスク（ファイル）を一覧表示し、選択・オープン・削除ができるファイルブラウザ機能を有すること。

- **R-4.2.4 (タスク並べ替え機能):** ⏳ 未実装（優先度: 低）
  - タスク一覧を以下の基準で並べ替えられること：
    - タスク名（昇順/降順）
    - 最終更新日時（新しい順/古い順）
    - 作成日時（新しい順/古い順）
    - タグ値（例：ステータス、優先度）
  - 並べ替え基準はUI上で選択可能とすること。

- **R-4.2.5 (タスクフィルタ機能):** ⏳ 未実装（優先度: 低）
  - タスク一覧を以下の条件でフィルタリングできること：
    - 完了タスクの非表示
    - 遅延タスクの絞り込み（期限超過）
    - 最終更新日による絞り込み（日付範囲指定）
    - タグ条件による絞り込み（複数条件のAND/OR）
  - 複数のフィルタを組み合わせて適用できること。

- **R-4.2.6 (タスクリネーム機能):** ✅ 実装済み（API完成、UI未統合）
  - タスクID（ファイル名）を変更できること。
  - リネーム時にファイルシステム上のファイル名も自動的に変更されること。
  - 他のタスクから参照されている場合（`depends_on`等）、参照も自動的に更新されること。
  - 実装: `renameTask` Tauri commandが存在、App.tsxに統合済み

---

### 4.3. タグ管理システム ✅ 95% 実装完了

- **R-4.3.1 (タグ情報の保存):** ✅ 実装済み
  - タスクの管理情報（タグ）は、各Markdownファイルの先頭に記述された「YAML Front Matter」ブロック内にキーと値のペアとして保存すること。

- **R-4.3.2 (タグの解析):** ✅ 実装済み
  - Rustバックエンドは、Tauriのファイルシステム機能を使用してワークスペース内の全タスクファイル（`.md`）をスキャンし、各ファイルのFront Matterを解析・集約すること。
  - 実装: `serde_yaml`を使用したFront Matter解析

- **R-4.3.3 (カテゴリ機能):** ✅ 実装済み
  - タグはカテゴリ（キー）と値（バリュー）の形式（例： `status: pending`）で管理すること。

- **R-4.3.4 (タグ選択UI):** ✅ 実装済み
  - エディタ（CodeMirror 6）には、Front Matterブロックの編集中に、既存のタグカテゴリと値をサジェストまたはドロップダウンから選択できるUIを統合すること。
  - 実装: CodeMirror 6カスタム拡張 `tagAutocomplete`

- **R-4.3.5 (タグリストの固定化):** ✅ 実装済み
  - アプリケーション設定により、タグの選択肢を「固定」または「任意追加可能」に切り替えられること。

- **R-4.3.6 (タグ管理モード):** ✅ 実装済み
  - 専用の「タグ管理モード」を設けること。
  - タグの「リネーム」、「編集」、「削除」のバッチ処理機能を提供すること。

- **R-4.3.7 (タグエイリアス機能):** ✅ 実装済み
  - タグカテゴリに対して、人間に優しい表示名（エイリアス）を設定できること。
  - 例：技術的なキー名`status`に対して日本語表示名`ステータス`を設定。

- **R-4.3.8 (タグ順序管理):** ✅ 実装済み
  - タスク編集画面において、タグの表示順序をドラッグ&ドロップで変更できること。
  - 変更された順序はFront Matterに反映されること。

- **R-4.3.9 (タグ値編集機能):** ✅ 実装済み
  - タグ編集パネルにおいて、タグの値を直接編集できること。
  - タグの属性タイプに応じた適切な入力UIを提供すること。

- **R-4.3.10 (タグ逆引き機能):** ⏳ 未実装（優先度: 低）
  - タグ管理画面において、特定のタグを使用しているタスクの一覧を表示できること。

- **R-4.3.11 (タグ管理の検索・フィルタ機能):** ⏳ 未実装（優先度: 低）
  - タグ管理画面において、タグを検索・フィルタリングできること。

---

### 4.4. タグテンプレート機能 ✅ 100% 実装完了

- **R-4.4.1 (テンプレートの登録):** ✅ 実装済み
  - ユーザーは、複数のタグ（カテゴリと値のペア）を組み合わせたタグセットを「テンプレート」として登録できること。

- **R-4.4.2 (テンプレートの編集):** ✅ 実装済み
  - 登録済みのテンプレートは、含まれるタグの追加・編集・削除ができること。

- **R-4.4.3 (テンプレートの適用):** ✅ 実装済み
  - タスク編集中に、既存のテンプレートを適用できること。
  - 新規タスク作成時にもテンプレートを選択できること。
  - **競合解決:** 上書きモード/マージモードを選択可能

- **R-4.4.7 (テンプレート連動型UI):** ✅ 実装済み
  - タスク編集画面において、タグの属性タイプ（R-4.8）に基づいた動的なUI要素を生成すること。

---

### 4.5. 分析モード ✅ 95% 実装完了

集約されたタグデータから、EChartsによる可視化を生成する機能を提供する。

- **R-4.5.1 (ガントチャート):** ✅ 実装済み
  - `start_date` / `end_date` / `depends_on` タグからタイムライン可視化を生成すること。
  - 実装: ECharts Gantt chart with dependency rendering

- **R-4.5.2 (円グラフ):** ✅ 実装済み
  - タグ値の分布を円グラフで表示すること。
  - 実装: ECharts Pie chart

- **R-4.5.3 (棒グラフ):** ✅ 実装済み
  - タグカテゴリの統計を棒グラフで表示すること。
  - 実装: ECharts Bar chart

- **R-4.5.4 (折れ線グラフ):** ✅ 実装済み
  - 時系列分析（例：完了トレンド）を折れ線グラフで表示すること。
  - 実装: ECharts Line chart

- **R-4.5.5 (エクスポート機能):** ⏳ 未実装（優先度: 低）
  - グラフをPNG/SVG形式でエクスポートできること。

---

## 実装状況サマリー

| 機能カテゴリ | 完成度 | 備考 |
|------------|--------|------|
| R-4.1: タスク編集 | 100% | 完全実装 |
| R-4.2: タスク管理 | 95% | ソート・フィルタ機能が未実装 |
| R-4.3: タグ管理 | 95% | 逆引き・検索機能が未実装 |
| R-4.4: タグテンプレート | 100% | 完全実装 |
| R-4.5: 分析モード | 95% | エクスポート機能が未実装 |

**全体平均:** 97%

## 参照

- [システムアーキテクチャ](01-architecture.md)
- [UI/UX要件](03-ui-ux-requirements.md)
- [高度な機能](04-advanced-features.md)
